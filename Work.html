<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />

	<!--
		Always force latest IE rendering engine (even in intranet) & Chrome Frame Remove this if you use the .htaccess
	-->

	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />

	<title>Work</title>
	<meta name="description" content="" />
	<meta name="author" content="James.bell" />

	<!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
	<link rel="shortcut icon" href="images/favicon.ico" />
	<link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <!-- Link CSS -->
    <link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.5.min.css" />
    <link rel="stylesheet" type="text/css" href="css/sir.mobile.custom.css" />

    <!-- Link JS -->
    <script type="text/javascript" src="js/jquery-1.10.2.js"></script>
    <script>
		$(document).bind("mobileinit", function()  {  
		    $.mobile.defaultPageTransition = 'none';  
		    $.mobile.defaultDialogTransition = 'none';  
		});
		
	</script>
	
	<style>
		.ui-page { 
			backface-visibility: hidden;  
		    -webkit-backface-visibility: hidden; /* Chrome and Safari */  
		    -moz-backface-visibility: hidden; /* Firefox */  
		}
		.ui-body-c, .ui-overlay-c {
			border: 1px solid #AAA;
			color: #333;
			background: #F9F9F9; 
		}
	</style>
    <script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
    <script type="text/javascript" src="js/sir.mobile.custom.js"></script>
    <script src="js/jquery.cookie.js"></script>

</head>

<body>

<!-- Page -->
<div data-role="page" class="ui-page ui-page-theme-a">

	<script>
		
		if ($.cookie('token') == 'null' || $.cookie('token') == undefined) {
			window.location.href = 'Login.html';
		}
		 
		var now = new Date();
		var year = now.getFullYear();
		var	month = now.getMonth() + 1;
		var	day = now.getDate();
		var weekDay = [
			'星期日',
			'星期一',
			'星期二',
			'星期三',
			'星期四',
			'星期五',
			'星期六'
		];
		var nowDate = year + '年' + month + '月' + day + '日';
		$('.ui-work-title').find('span').html(nowDate);
		$('.ui-work-title').find('u').html(weekDay[now.getDay()]);
	</script>

	<div data-role="header" class="ui-header ui-bar-inherit">
		<h1 class="ui-title" role="heading" aria-level="1">考勤</h1>		
	</div>

	<div role="main" class="ui-content ui-index-content">
        <h2 class="ui-work-title">
            <span></span>
            <u></u>
        </h2>
        <div class="ui-work-sign up">
            <h5>上班：<u>09:00</u></h5>
            <h5 class="checkin-time">签到：<u></u></h5>
            <button class="ui-btn ui-corner-all checkin">签到</button>
        </div>
        <div class="ui-work-sign off">
            <h5>下班：<u>18:00</u></h5>
            <h5 class="checkout-time">签到：<u></u></h5>
            <button class="ui-btn ui-corner-all checkout">签退</button>
        </div>
	</div>
<script type="text/javascript">
	var attendance = new Attendance();
	var attendanceInfo = JSON.parse(attendance.getInfo());
	var loc = "";
	function getGps(){
		var gps = navigator.geolocation;
		if(gps){
			gps.getCurrentPosition(pushgps,function(error){
				alert("Got an error, code: " + error.code + " message: "+ error.message);
			});
		}else{
			alert("无法定位");
		}
	}
	function pushgps(position){
		if(position){
			loc = position;
		}else{
			alert("position is null");
		}
	}
	
	if(!attendanceInfo.checkin){
		$('.checkin').on('click',function(){
			getGps();
			var response = JSON.parse(attendance.checkin(loc));
			alert(response.message);
			if(response.result){
				window.location.href = window.location.href;
			}
		})
	}else{
		$('.checkin').unbind('click');
		$('.checkin').css({'background-color':'grey','border-color':'grey'});
		$('.checkin-time u').html(attendanceInfo.checkin.split(" ")[1]);
	}
	if(!attendanceInfo.checkout){
		$('.checkout').on('click',function(){
			getGps();
			var response = JSON.parse(attendance.checkout(loc));
			alert(response.message);
			if(response.result){
				window.location.href = window.location.href;
			}
		})
	}else{
		$('.checkout').unbind('click');
		$('.checkout').css({'background-color':'grey','border-color':'grey'});
		$('.checkout-time u').html(attendanceInfo.checkout.split(" ")[1]);
	}

</script>
    <!-- footer -->
    <div data-role="footer" class="ui-footer ui-footer-fixed ui-bar-inherit">
				<div class="ui-navbar">
				    <ul class="ui-grid-c">
					<li class="ui-block-a"><a data-transition="none" data-icon="grid" class="ui-link ui-btn ui-icon-mail ui-btn-icon-top">邮箱</a></li>
					<li class="ui-block-b"><a data-transition="none" data-icon="star" class="ui-link ui-btn ui-icon-bars ui-btn-icon-top">文档</a></li>
					<li class="ui-block-c"><a data-transition="none" data-icon="gear" class="ui-link ui-btn ui-icon-calendar ui-btn-icon-top ui-btn-active">考勤</a></li>
					<li class="ui-block-d"><a data-transition="none" data-icon="gear" class="ui-link ui-btn ui-icon-grid ui-btn-icon-top">应用</a></li>
				    </ul>
				</div>
	</div>
<script>
            $('.ui-block-a').on('click', function(event) {
                event.preventDefault();
                $.mobile.changePage('index.html', {
                    reloadPage: true,
                    reverse: false
                });
            });
            $('.ui-block-b').on('click', function(event) {
                event.preventDefault();
                $.mobile.changePage('Folder.html?path=', {
                    reloadPage: true,
                    reverse: false
                });
            });
            $('.ui-block-c').on('click', function(event) {
                event.preventDefault();
                $.mobile.changePage('Work.html', {
                    reloadPage: true,
                    reverse: false
                });
            });
            $('.ui-block-d').on('click', function(event) {
                event.preventDefault();
                $.mobile.changePage('Application.html', {
                    reloadPage: true,
                    reverse: false
                });
            });
</script>
</div>
	<script>
		$(function () {
			$('.ui-work-title').find('span').html(nowDate);
			$('.ui-work-title').find('u').html(weekDay[now.getDay()]);
		});
	</script>
</body>

</html>
